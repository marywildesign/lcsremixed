const contentEl=document.getElementById("content"),viewportEl=document.getElementById("viewport"),colophon=document.getElementById("colophon"),aboutBtn=document.getElementById("aboutBtn"),closeBtn=document.getElementById("closeColophon"),isMobile=/Mobi|Android|iPhone|iPad|iPod/i.test(navigator.userAgent);let maxScroll=0,speed=40,running=!1,lastFrame=0,rafId,currentMode="block",originalText="",processedHTML={},bannedSet=new Set,tokens=[];const upDiac="̡̧̢̛̤̪̫̬̭̮̯̰̱̲̳̍̎̄̅̿̑̐̇̈̉̊̋̓̔̽͂̆̚",midDiac="̡̢̧̨̨̢̡̨̨̨̢̛̛̙̜̝̞̤̥̩̪̫̬̭̮̯̰̱̕̚",downDiac="̖̗̘̙̜̝̞̟̠̤̥̦̩̪̫̬̭̮̯̰̱̲̳̖̗̘̙̍̎̏̿̑̐̇̈̉̊̋̌̓̔̚̕̚";function getAssetPath(e){return"localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname?`./${e}`:`/lcsremixed/${e}`}async function loadAssets(){let[e,t]=await Promise.all([fetch(getAssetPath("full.txt")).catch(e=>{throw Error("Failed to load full.txt: "+e)}),fetch(getAssetPath("bannedWords.txt")).catch(e=>{throw Error("Failed to load bannedWords.txt: "+e)})]);originalText=await e.text();let o=await t.text();return bannedSet=new Set(o.trim().split("\n").map(e=>e.trim().toLowerCase())),!0}async function loadText(){try{await loadAssets(),tokenizeText(),contentEl.innerHTML="Loading...",setTimeout(()=>applyDefaultCensored(),200),setTimeout(()=>{["blur","dots","zalgo"].forEach(e=>{processedHTML[e]||(processedHTML[e]=render(e))})},1e3)}catch(e){console.error("Critical error:",e),contentEl.innerHTML=`
      <div style="padding: 40px; text-align: center;">
        <h2>Unable to load content</h2>
        <p>Please try again later or check your network connection.</p>
      </div>
    `}}function tokenizeText(){let e=originalText.split(/\b/);tokens=e.map(e=>{let t=e.replace(/[^a-zA-Z]/g,"").toLowerCase();return{raw:e,clean:t,banned:bannedSet.has(t)}})}function render(e){return tokens.map(t=>{if(!t.banned)return t.raw;switch(e){case"blur":return`<span class="blur">${t.raw}</span>`;case"dots":return`<span class="dots">${dotify(t.clean)}</span>`;case"zalgo":return`<span class="zalgo">${zalgoize(t.clean)}</span>`;default:return`<span class="blocked">${"█".repeat(t.clean.length)}</span>`}}).join("")}function applyDefaultCensored(){processedHTML.block=render("block"),contentEl.innerHTML=processedHTML.block,requestAnimationFrame(()=>{(maxScroll=contentEl.scrollHeight-viewportEl.clientHeight)<0&&(maxScroll=0),isMobile||start()})}function dotify(e){let t=["\xb7",".","∙","‧","․","‥","…","\xb7","•","‣","⁃","⋅","⋆","⋮","⋯","⋰","⋱","\uD800\uDD01","࠰","܁","܂","۔","・","･","。","⁘","⁙","◌̇","◌̣","◌⃛","◌⃜",":","⠇"],o="";for(let n=0;n<Math.min(3*e.length,30);n++)o+=Math.random()>.5?t[Math.floor(Math.random()*t.length)]:"";return o}function zalgoize(e){let t="";return e.split("").forEach(e=>{let o=e;for(let n=0;n<Math.min(Math.floor(3*Math.random())+2,10);n++)o+=upDiac[Math.floor(Math.random()*upDiac.length)];for(let r=0;r<Math.min(Math.floor(2*Math.random())+1,10);r++)o+=midDiac[Math.floor(Math.random()*midDiac.length)];for(let a=0;a<Math.min(Math.floor(3*Math.random())+3,10);a++)o+=downDiac[Math.floor(Math.random()*downDiac.length)];t+=o}),t}function start(){running||(running=!0,lastFrame=performance.now(),rafId=requestAnimationFrame(tick))}function tick(e){let t=(e-lastFrame)/1e3;viewportEl.scrollTop+=speed*t,viewportEl.scrollTop>=maxScroll&&(viewportEl.scrollTop=0),lastFrame=e,rafId=requestAnimationFrame(tick),performance.memory&&performance.memory.usedJSHeapSize>2e8&&console.warn("High memory usage detected")}document.querySelectorAll("#obscureControls button").forEach(e=>{e.addEventListener("click",()=>{currentMode=e.dataset.mode,document.querySelectorAll("#obscureControls button").forEach(e=>e.classList.remove("active")),e.classList.add("active"),processedHTML[currentMode]||(processedHTML[currentMode]=render(currentMode)),contentEl.innerHTML=processedHTML[currentMode]})}),aboutBtn.onclick=()=>colophon.classList.add("open"),closeBtn.onclick=()=>colophon.classList.remove("open"),document.addEventListener("click",e=>{colophon.contains(e.target)||aboutBtn.contains(e.target)||colophon.classList.remove("open")}),document.addEventListener("visibilitychange",()=>{document.hidden?(cancelAnimationFrame(rafId),running=!1):start()}),viewportEl.addEventListener("touchstart",e=>e.preventDefault()),viewportEl.addEventListener("touchmove",e=>e.preventDefault()),window.addEventListener("load",loadText);